<?xml version="1.0" encoding="utf-8"?>
<widget id="mendix.advancedsankeyv2.AdvancedSankeyV2" pluginWidget="true" needsEntityContext="true" offlineCapable="true"
        supportedPlatform="Web"
        xmlns="http://www.mendix.com/widget/1.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.mendix.com/widget/1.0/ ../node_modules/mendix/custom_widget.xsd">
    <name>Advanced Sankey V2</name>
    <description>Diagramme Sankey simplifié utilisant les EnergyFlowNode créés par JavaAction</description>
    <icon/>
    <properties>
        <!-- Configuration des flux EnergyFlowNode -->
        <propertyGroup caption="Configuration des flux énergétiques">
            <property key="energyFlowDataSource" type="datasource" isList="true" required="true">
                <caption>Source des flux énergétiques</caption>
                <description>Liste des EnergyFlowNode créés par JavaAction (CreateEnergyFlowNodes + CalculateEnergyFlow)</description>
            </property>
            <property key="sourceAssetAttribute" type="attribute" dataSource="energyFlowDataSource" required="true">
                <caption>Asset source</caption>
                <description>Association vers l'asset source du flux</description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>
            <property key="targetAssetAttribute" type="attribute" dataSource="energyFlowDataSource" required="true">
                <caption>Asset cible</caption>
                <description>Association vers l'asset cible du flux</description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>
            <property key="flowValueAttribute" type="attribute" dataSource="energyFlowDataSource" required="true">
                <caption>Valeur du flux</caption>
                <description>Valeur énergétique du flux (calculée par CalculateEnergyFlow)</description>
                <attributeTypes>
                    <attributeType name="Decimal"/>
                </attributeTypes>
            </property>
            <property key="percentageAttribute" type="attribute" dataSource="energyFlowDataSource" required="true">
                <caption>Pourcentage du flux</caption>
                <description>Pourcentage du flux par rapport au parent (calculé par CalculateEnergyFlow)</description>
                <attributeTypes>
                    <attributeType name="Decimal"/>
                </attributeTypes>
            </property>
        </propertyGroup>
        
        <!-- Configuration énergétique simplifiée -->
        <propertyGroup caption="Configuration énergétique">
            <property key="energyType" type="enumeration" defaultValue="elec" required="true">
                <caption>Type d'énergie</caption>
                <description>Type d'énergie affiché dans le diagramme (correspond aux JavaActions)</description>
                <enumerationValues>
                    <enumerationValue key="elec">Électricité (kWh)</enumerationValue>
                    <enumerationValue key="gaz">Gaz (m³)</enumerationValue>
                    <enumerationValue key="eau">Eau (m³)</enumerationValue>
                    <enumerationValue key="air">Air comprimé (m³)</enumerationValue>
                </enumerationValues>
            </property>
            <property key="metricType" type="enumeration" defaultValue="Conso" required="true">
                <caption>Type de métrique</caption>
                <description>Type de métrique énergétique (correspond aux JavaActions)</description>
                <enumerationValues>
                    <enumerationValue key="Conso">Consommation</enumerationValue>
                    <enumerationValue key="IPE">IPE (Indice Performance Énergétique)</enumerationValue>
                    <enumerationValue key="IPE_kg">IPE par kg produit</enumerationValue>
                    <enumerationValue key="Prod">Production</enumerationValue>
                    <enumerationValue key="Prod_kg">Production en kg</enumerationValue>
                </enumerationValues>
            </property>
        </propertyGroup>

        <!-- Configuration de l'affichage -->
        <propertyGroup caption="Configuration de l'affichage">
            <property key="title" type="string" required="false">
                <caption>Titre du diagramme</caption>
                <description>Titre affiché au-dessus du diagramme Sankey</description>
            </property>
            <property key="width" type="integer" defaultValue="800">
                <caption>Largeur</caption>
                <description>Largeur du diagramme en pixels</description>
            </property>
            <property key="height" type="integer" defaultValue="600">
                <caption>Hauteur</caption>
                <description>Hauteur du diagramme en pixels</description>
            </property>
            <property key="showValues" type="boolean" defaultValue="true">
                <caption>Afficher les valeurs</caption>
                <description>Afficher les valeurs numériques sur les nœuds</description>
            </property>
        </propertyGroup>

        <!-- Interactions -->
        <propertyGroup caption="Interactions">
            <property key="onNodeClick" type="action" required="false">
                <caption>Action au clic sur nœud</caption>
                <description>Action à exécuter lors du clic sur un nœud</description>
            </property>
            <property key="onNodeDetails" type="action" required="false">
                <caption>Action vue détaillée (Ctrl+clic)</caption>
                <description>Action à exécuter lors du Ctrl+clic sur un nœud pour ouvrir la vue détaillée</description>
            </property>
            <property key="selectedAssetNameAttribute" type="attribute" required="false">
                <caption>SelectedAssetName (DataView)</caption>
                <description>Attribut string du DataView SelectedAsset où stocker le Nom de l'Asset cliqué (Ctrl+clic)</description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>
        </propertyGroup>

        <!-- Développement et debug -->
        <propertyGroup caption="Développement">
            <property key="showDebugTools" type="boolean" defaultValue="false">
                <caption>Afficher les outils de débogage</caption>
                <description>Active l'affichage des informations de débogage pour le développement</description>
            </property>
        </propertyGroup>
    </properties>
</widget>