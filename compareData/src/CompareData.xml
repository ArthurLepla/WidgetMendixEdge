<?xml version="1.0" encoding="utf-8"?>
<widget id="mendix.comparedata.CompareData" pluginWidget="true" needsEntityContext="true" offlineCapable="true"
        supportedPlatform="Web"
        xmlns="http://www.mendix.com/widget/1.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.mendix.com/widget/1.0/ ../node_modules/mendix/custom_widget.xsd">
    <name>Compare Data</name>
    <description>Widget de comparaison des données de consommation entre machines</description>
    <icon/>
    <properties>
        <propertyGroup caption="General">
            <propertyGroup caption="Configuration">
                <property key="devMode" type="boolean" defaultValue="false">
                    <caption>Mode développeur</caption>
                    <description>Activer le mode développeur pour simuler les données (sans mapper les attributs réels)</description>
                </property>
                <property key="viewMode" type="enumeration" defaultValue="energetic">
                    <caption>Mode de visualisation</caption>
                    <description>Choisir entre le mode énergétique ou IPE</description>
                    <enumerationValues>
                        <enumerationValue key="energetic">Énergétique</enumerationValue>
                        <enumerationValue key="ipe">IPE</enumerationValue>
                    </enumerationValues>
                </property>
                <property key="energyType" type="enumeration" defaultValue="electricity">
                    <caption>Type d'énergie</caption>
                    <description>Sélectionner le type d'énergie à afficher</description>
                    <enumerationValues>
                        <enumerationValue key="electricity">Électricité</enumerationValue>
                        <enumerationValue key="gas">Gaz</enumerationValue>
                        <enumerationValue key="water">Eau</enumerationValue>
                        <enumerationValue key="air">Air</enumerationValue>
                    </enumerationValues>
                </property>
                <!-- Paramètre spécifique au mode IPE : énergie de référence pour résoudre les unités depuis les variables d'asset. -->
                <property key="ipeEnergyType" type="enumeration" defaultValue="Elec">
                    <caption>IPE – Énergie ciblée</caption>
                    <description>Énergie de référence utilisée en mode IPE pour détecter les variantes (IPE / IPE_kg) et résoudre les unités à partir des variables de l'asset sélectionné. Ignoré en mode énergétique.</description>
                    <enumerationValues>
                        <enumerationValue key="Elec">Électricité</enumerationValue>
                        <enumerationValue key="Gaz">Gaz</enumerationValue>
                        <enumerationValue key="Eau">Eau</enumerationValue>
                        <enumerationValue key="Air">Air</enumerationValue>
                    </enumerationValues>
                </property>
                <property key="baseUnit" type="enumeration" defaultValue="auto">
                    <caption>Unité de base des données</caption>
                    <description>Choisir l'unité dans laquelle arrivent les données d'entrée (Auto = unité par défaut selon le type d'énergie)</description>
                    <enumerationValues>
                        <enumerationValue key="auto">Auto (selon type d'énergie)</enumerationValue>
                        <enumerationValue key="kWh">kWh (kilowatt-heure)</enumerationValue>
                        <enumerationValue key="m3">m³ (mètre cube)</enumerationValue>
                    </enumerationValues>
                </property>
                <property key="ipeMode" type="enumeration" defaultValue="single">
                    <caption>Mode IPE</caption>
                    <description>Choisir entre un IPE simple ou double</description>
                    <enumerationValues>
                        <enumerationValue key="single">Simple IPE</enumerationValue>
                        <enumerationValue key="double">Double IPE</enumerationValue>
                    </enumerationValues>
                </property>
                <property key="onAddProductionClick" type="action" required="false">
                    <caption>Action de saisie de production</caption>
                    <description>Action à exécuter pour naviguer vers la page de saisie de production</description>
                </property>
                <property key="enableTestMode" type="boolean" defaultValue="false">
                    <caption>Mode Test</caption>
                    <description>Activer le mode test pour afficher les données de test</description>
                </property>
            </propertyGroup>

            <propertyGroup caption="Data source">
                <property key="selectedMachines" type="datasource" isList="true" required="false">
                    <caption>Machines sélectionnées</caption>
                    <description>Liste des machines sélectionnées (SelectedMachine)</description>
                </property>
                <property key="attrMachineName" type="attribute" dataSource="selectedMachines" required="false">
                    <caption>Nom de la machine</caption>
                    <description>Attribut contenant le nom de la machine</description>
                    <attributeTypes>
                        <attributeType name="String"/>
                    </attributeTypes>
                </property>

                <property key="dsMesures" type="datasource" isList="true" required="false">
                    <caption>Mesures des machines</caption>
                    <description>Liste des mesures (Mesure_machine)</description>
                </property>
                <property key="attrMachineMesureName" type="attribute" dataSource="dsMesures" required="false">
                    <caption>Nom de la machine (mesure)</caption>
                    <description>Attribut contenant le nom de la machine dans les mesures</description>
                    <attributeTypes>
                        <attributeType name="String"/>
                    </attributeTypes>
                </property>
                <property key="attrTimestamp" type="attribute" dataSource="dsMesures" required="false">
                    <caption>Horodatage</caption>
                    <description>Horodatage de la mesure</description>
                    <attributeTypes>
                        <attributeType name="DateTime"/>
                    </attributeTypes>
                </property>
                <property key="attrConsommation" type="attribute" dataSource="dsMesures" required="false">
                    <caption>Consommation</caption>
                    <description>Valeur de consommation</description>
                    <attributeTypes>
                        <attributeType name="Decimal"/>
                    </attributeTypes>
                </property>
                <!-- Attributs optionnels pour alignement avec Detailswidget (détection fiable du type et de l'énergie) -->
                <property key="attrMetricType" type="attribute" dataSource="dsMesures" required="false">
                    <caption>Type de métrique</caption>
                    <description>Attribut MetricType pour identifier le type de variable (Conso, IPE, IPE_kg, Prod, etc.)</description>
                    <attributeTypes>
                        <attributeType name="Enum"/>
                    </attributeTypes>
                </property>
                <property key="attrEnergyType" type="attribute" dataSource="dsMesures" required="false">
                    <caption>Type d'énergie</caption>
                    <description>Attribut EnergyType pour identifier le type d'énergie (Elec, Gaz, Eau, Air, None)</description>
                    <attributeTypes>
                        <attributeType name="Enum"/>
                    </attributeTypes>
                </property>
            </propertyGroup>

            <!-- Période d'analyse (déplacée hors de Data source pour s'aligner avec Detailswidget) -->
            <propertyGroup caption="Période d'analyse">
                <property key="dateDebut" type="attribute" required="false">
                    <caption>Date de début</caption>
                    <description>Date de début de la période</description>
                    <attributeTypes>
                        <attributeType name="DateTime"/>
                    </attributeTypes>
                </property>
                <property key="dateFin" type="attribute" required="false">
                    <caption>Date de fin</caption>
                    <description>Date de fin de la période</description>
                    <attributeTypes>
                        <attributeType name="DateTime"/>
                    </attributeTypes>
                </property>
            </propertyGroup>

            <propertyGroup caption="Data source 2 (Double IPE)">
                <property key="selectedMachines2" type="datasource" isList="true" required="false">
                    <caption>Machines sélectionnées 2</caption>
                    <description>Liste des machines sélectionnées pour le deuxième IPE (requis en mode double)</description>
                </property>
                <property key="attrMachineName2" type="attribute" dataSource="selectedMachines2" required="false">
                    <caption>Nom de la machine 2</caption>
                    <description>Attribut contenant le nom de la machine pour le deuxième IPE</description>
                    <attributeTypes>
                        <attributeType name="String"/>
                    </attributeTypes>
                </property>

                <property key="dsMesures2" type="datasource" isList="true" required="false">
                    <caption>Mesures des machines 2</caption>
                    <description>Liste des mesures pour le deuxième IPE (requis en mode double)</description>
                </property>
                <property key="attrMachineMesureName2" type="attribute" dataSource="dsMesures2" required="false">
                    <caption>Nom de la machine (mesure) 2</caption>
                    <description>Attribut contenant le nom de la machine dans les mesures pour le deuxième IPE</description>
                    <attributeTypes>
                        <attributeType name="String"/>
                    </attributeTypes>
                </property>
                <property key="attrTimestamp2" type="attribute" dataSource="dsMesures2" required="false">
                    <caption>Horodatage 2</caption>
                    <description>Horodatage de la mesure pour le deuxième IPE</description>
                    <attributeTypes>
                        <attributeType name="DateTime"/>
                    </attributeTypes>
                </property>
                <property key="attrConsommation2" type="attribute" dataSource="dsMesures2" required="false">
                    <caption>Consommation 2</caption>
                    <description>Valeur de consommation pour le deuxième IPE</description>
                    <attributeTypes>
                        <attributeType name="Decimal"/>
                    </attributeTypes>
                </property>
                <!-- Attributs optionnels pour DS2 (alignement Detailswidget) -->
                <property key="attrMetricType2" type="attribute" dataSource="dsMesures2" required="false">
                    <caption>Type de métrique 2</caption>
                    <description>Attribut MetricType pour le deuxième IPE (Conso, IPE, IPE_kg, Prod, etc.)</description>
                    <attributeTypes>
                        <attributeType name="Enum"/>
                    </attributeTypes>
                </property>
                <property key="attrEnergyType2" type="attribute" dataSource="dsMesures2" required="false">
                    <caption>Type d'énergie 2</caption>
                    <description>Attribut EnergyType pour le deuxième IPE (Elec, Gaz, Eau, Air, None)</description>
                    <attributeTypes>
                        <attributeType name="Enum"/>
                    </attributeTypes>
                </property>
            </propertyGroup>

            <!-- Période d'analyse 2 -->
            <propertyGroup caption="Période d'analyse 2">
                <property key="dateDebut2" type="attribute" required="false">
                    <caption>Date de début 2</caption>
                    <description>Date de début de la période pour le deuxième IPE</description>
                    <attributeTypes>
                        <attributeType name="DateTime"/>
                    </attributeTypes>
                </property>
                <property key="dateFin2" type="attribute" required="false">
                    <caption>Date de fin 2</caption>
                    <description>Date de fin de la période pour le deuxième IPE</description>
                    <attributeTypes>
                        <attributeType name="DateTime"/>
                    </attributeTypes>
                </property>
            </propertyGroup>
            <!-- Noms IPE retirés: le libellé du toggle sera dérivé automatiquement (ex: IPE, IPE_kg) -->
        </propertyGroup>

        <!-- ==================== Granularité ==================== -->
        <propertyGroup caption="Affichage Granularité (Lecture)">
            <property key="displayModeAttr" type="attribute" required="false">
                <caption>Attribut Mode (Lecture)</caption>
                <description>Attribut pour le mode (Auto/Strict).</description>
                <attributeTypes>
                    <attributeType name="Enum"/>
                </attributeTypes>
            </property>
            <property key="displayTimeAttr" type="attribute" required="false">
                <caption>Attribut Time (Lecture)</caption>
                <description>Attribut pour la valeur de temps.</description>
                <attributeTypes>
                    <attributeType name="Integer"/>
                </attributeTypes>
            </property>
            <property key="displayUnitAttr" type="attribute" required="false">
                <caption>Attribut Unit (Lecture)</caption>
                <description>Attribut pour l'unité de temps.</description>
                <attributeTypes>
                    <attributeType name="Enum"/>
                </attributeTypes>
            </property>
            <property key="displayPreviewOKAttr" type="attribute" required="false">
                <caption>Attribut Preview OK (Lecture)</caption>
                <description>Attribut booléen indiquant si la configuration est valide.</description>
                <attributeTypes>
                    <attributeType name="Boolean"/>
                </attributeTypes>
            </property>
        </propertyGroup>

        <propertyGroup caption="Buffer Granularité (Écriture)">
            <property key="bufferModeAttr" type="attribute" required="false">
                <caption>Attribut Mode (Écriture)</caption>
                <description>Attribut pour stocker le changement de mode.</description>
                <attributeTypes>
                    <attributeType name="Enum"/>
                </attributeTypes>
            </property>
            <property key="bufferTimeAttr" type="attribute" required="false">
                <caption>Attribut Time (Écriture)</caption>
                <description>Attribut pour stocker le changement de valeur.</description>
                <attributeTypes>
                    <attributeType name="Integer"/>
                </attributeTypes>
            </property>
            <property key="bufferUnitAttr" type="attribute" required="false">
                <caption>Attribut Unit (Écriture)</caption>
                <description>Attribut pour stocker le changement d'unité.</description>
                <attributeTypes>
                    <attributeType name="Enum"/>
                </attributeTypes>
            </property>
            <property key="onModeChange" type="action" required="false">
                <caption>On Mode Change</caption>
                <description>Microflow à exécuter quand le mode change.</description>
            </property>
            <property key="onTimeChange" type="action" required="false">
                <caption>On Time/Unit Change</caption>
                <description>Microflow à exécuter quand la valeur ou l'unité change.</description>
            </property>
        </propertyGroup>

        <!-- ==================== Feature Toggles ==================== -->
        <propertyGroup caption="Feature Toggles">
            <property key="featureList" type="datasource" isList="true" required="false">
                <caption>FeatureToggle – liste activée</caption>
                <description>Liste des features activées pour ce widget</description>
            </property>
            <property key="featureNameAttr" type="attribute" dataSource="featureList" required="false">
                <caption>Attribut FeatureName</caption>
                <description>Attribut contenant le nom de la feature</description>
                <attributeTypes>
                    <attributeType name="Enum"/>
                </attributeTypes>
            </property>
        </propertyGroup>

        <!-- ==================== Variables de l'Asset ==================== -->
        <propertyGroup caption="Variables de l'Asset">
            <property key="assetVariablesDataSource" type="datasource" isList="true" required="false">
                <caption>Variables de l'asset</caption>
                <description>Liste des variables de l'asset sélectionné pour récupérer les unités automatiquement</description>
            </property>
            <property key="variableNameAttr" type="attribute" dataSource="assetVariablesDataSource" required="false">
                <caption>Attribut Nom Variable</caption>
                <description>Attribut contenant le nom de la variable</description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>
            <property key="variableUnitAttr" type="attribute" dataSource="assetVariablesDataSource" required="false">
                <caption>Attribut Unité Variable</caption>
                <description>Attribut contenant l'unité de la variable</description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>
            <property key="variableMetricTypeAttr" type="attribute" dataSource="assetVariablesDataSource" required="false">
                <caption>Attribut Type Métrique Variable</caption>
                <description>Attribut contenant le type de métrique de la variable</description>
                <attributeTypes>
                    <attributeType name="Enum"/>
                </attributeTypes>
            </property>
            <property key="variableEnergyTypeAttr" type="attribute" dataSource="assetVariablesDataSource" required="false">
                <caption>Attribut Type Énergie Variable</caption>
                <description>Attribut contenant le type d'énergie de la variable</description>
                <attributeTypes>
                    <attributeType name="Enum"/>
                </attributeTypes>
            </property>
        </propertyGroup>

        <propertyGroup caption="Common">
            <systemProperty key="Name"/>
            <systemProperty key="TabIndex"/>
            <systemProperty key="Visibility"/>
        </propertyGroup>
        <propertyGroup caption="Données IPE (Production/Consommation)">
            <property key="dsProduction_Consommation" type="datasource" isList="true" required="false">
                <caption>Production/Consommation IPE</caption>
                <description>Liste des données de production et consommation pour le calcul IPE. Requis en mode IPE. Non requis si Mode Test activé.</description>
            </property>
            <property key="attrMachineProductionName" type="attribute" dataSource="dsProduction_Consommation" required="false">
                <caption>Nom machine (production)</caption>
                <description>Nom de la machine dans les données de production. Requis en mode IPE. Non requis si Mode Test activé.</description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>
            <property key="attrProduction" type="attribute" dataSource="dsProduction_Consommation" required="false">
                <caption>Production</caption>
                <description>Valeur de production (nombre de pièces). Requis en mode IPE. Non requis si Mode Test activé.</description>
                <attributeTypes>
                    <attributeType name="Decimal"/>
                </attributeTypes>
            </property>
            <property key="attrConsommationIPE" type="attribute" dataSource="dsProduction_Consommation" required="false">
                <caption>Consommation IPE</caption>
                <description>Valeur de consommation pour le calcul IPE. Requis en mode IPE. Non requis si Mode Test activé.</description>
                <attributeTypes>
                    <attributeType name="Decimal"/>
                </attributeTypes>
            </property>
        </propertyGroup>
        <propertyGroup caption="Données IPE 2 (Production/Consommation)">
            <property key="dsProduction_Consommation2" type="datasource" isList="true" required="false">
                <caption>Production/Consommation IPE 2</caption>
                <description>Liste des données de production et consommation pour le calcul du deuxième IPE. Requis en mode double IPE.</description>
            </property>
            <property key="attrMachineProductionName2" type="attribute" dataSource="dsProduction_Consommation2" required="false">
                <caption>Nom machine (production) 2</caption>
                <description>Nom de la machine dans les données de production pour le deuxième IPE. Requis en mode double IPE.</description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>
            <property key="attrProduction2" type="attribute" dataSource="dsProduction_Consommation2" required="false">
                <caption>Production 2</caption>
                <description>Valeur de production (nombre de pièces) pour le deuxième IPE. Requis en mode double IPE.</description>
                <attributeTypes>
                    <attributeType name="Decimal"/>
                </attributeTypes>
            </property>
            <property key="attrConsommationIPE2" type="attribute" dataSource="dsProduction_Consommation2" required="false">
                <caption>Consommation IPE 2</caption>
                <description>Valeur de consommation pour le calcul du deuxième IPE. Requis en mode double IPE.</description>
                <attributeTypes>
                    <attributeType name="Decimal"/>
                </attributeTypes>
            </property>
        </propertyGroup>
    </properties>
</widget>